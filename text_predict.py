#encoding:utf-8
from text_model import *
import  tensorflow as tf
import tensorflow.keras as kr
import os
import numpy as np
import jieba
import re
import heapq
import codecs



def predict(sentences):
    config = TextConfig()
    config.pre_trianing = get_training_word2vec_vectors(config.vector_word_npz)
    model = TextRNN(config)
    save_dir = r'F:\ALL_model\lstm\ASK_google\checkpoints\textrnn'
    save_path = os.path.join(save_dir, 'best_validation')

    _,word_to_id=read_vocab(config.vocab_filename)
    input_x= process_file(sentences,word_to_id,max_length=config.seq_length)
    labels ={0: 'Unable to walk', 1: 'Menstrual cramp', 2: 'Chronic back pain', 3: 'Depressed mood', 4: 'Dysphagia', 5: 'Wheezing', 6: 'Immunosuppression', 7: 'Difficulty dressing', 8: 'Frequent night waking', 9: 'Diplopia', 10: 'Flatulence, eructation and gas pain', 11: 'Hypertonia', 12: 'Collapse', 13: 'morphine', 14: 'Aphasia', 15: 'Uterus problem', 16: 'ibuprofen', 17: 'Visual disturbance', 18: 'Heart valve regurgitation', 19: 'Discolouration of skin', 20: 'Epistaxis', 21: 'Syncope', 22: 'Lipex', 23: 'Craving for food or drink', 24: 'Arthritis of hand', 25: 'Stumbling gait', 26: 'Productive cough', 27: 'Intercostal myalgia', 28: 'Peeling of skin', 29: 'Reduced concentration', 30: 'Night pain', 31: 'Parkinsonism', 32: 'Erectile dysfunction', 33: 'Lacks confidence', 34: "Sjé°ƒren's syndrome", 35: 'Shoulder pain', 36: 'Otalgia', 37: 'Deep pain', 38: 'Feeling content', 39: 'Abdominal muscles tense', 40: 'Pain in cheek', 41: 'Speech impairment', 42: 'Acute pain', 43: 'Disorder of nasal sinus', 44: 'Increased albumin', 45: 'Menopause present', 46: 'Lumbar facet joint pain', 47: 'Slurred speech', 48: 'Feeling nervous', 49: 'Finding of increased blood pressure', 50: 'Elbow joint pain', 51: 'Panadeine', 52: 'Low back strain', 53: 'Feeling agitated 232 249', 54: 'Hand eczema', 55: 'Decreased venous pressure', 56: 'Gastric ulcer', 57: 'Nasal congestion', 58: 'Renal failure', 59: 'melatonin', 60: 'Pain of uterus', 61: 'Limping', 62: 'Photosensitisation due to sun', 63: 'Muscle strain', 64: 'Disorder of foot', 65: 'Lip swelling', 66: 'oestradiol', 67: 'Osteoarthritis', 68: 'Swelling of hand', 69: 'ezetimibe + simvastatin', 70: 'Unable to move', 71: 'Abdominal distension', 72: 'Pain in left arm', 73: 'Hand joint pain', 74: 'Enbrel', 75: 'Decreased range of shoulder movement', 76: 'Pain in upper limb', 77: 'Cut of hand', 78: 'Hallucinations', 79: 'Myalgia/myositis - multiple', 80: 'Cold foot', 81: 'Toprol-XL', 82: 'Disturbance in speech rhythm', 83: 'Shoulder tendonitis', 84: 'Rupture tendon thigh', 85: 'Symptom of ankle', 86: 'Random blood sugar raised', 87: 'B Complex (Cenovis)', 88: 'Difficulty walking up stairs', 89: 'Prolonged periods', 90: 'Cervical arthritis', 91: 'Celebrex 200 mg capsule: hard', 92: 'Menorrhagia', 93: 'Low back pain', 94: 'Stiffness', 95: 'Stomach cramps', 96: 'Lipitor 40 mg tablet: film-coated', 97: 'Tight chest', 98: 'Diastolic dysfunction', 99: 'lisinopril', 100: 'Excessive and frequent menstruation', 101: 'Zoloft', 102: 'Contracture of tendon of ankle region', 103: 'Rectal haemorrhage', 104: 'Atacand', 105: 'fenofibrate 145 mg tablet', 106: 'Hearing loss', 107: 'Tendonitis', 108: 'Cramping pain', 109: 'Abnormal gait', 110: 'Severe vertigo', 111: 'Drinks wine', 112: 'Ankle oedema', 113: 'Gland symptom', 114: 'Rupture of tendon of lower leg and ankle', 115: 'Generalised aches and pains', 116: 'Unable to think clearly', 117: 'Palpitations - rapid', 118: 'Burning epigastric pain', 119: 'Urgent desire to urinate', 120: 'Abnormal weight gain', 121: 'Tagamet', 122: 'Foot swelling', 123: 'Lightheadedness', 124: 'Yellow skin', 125: 'Clumsiness', 126: 'Seroquel', 127: 'Unable to find words', 128: 'Gout', 129: 'Walking disability', 130: 'Reduced mobility', 131: 'Oedema', 132: 'Diovan', 133: 'Impaired mobility', 134: 'Frequent defaecation', 135: 'Disorder of back', 136: 'Arthritis of shoulder region joint', 137: 'Ill-at-ease', 138: 'Pulse fast', 139: 'Reduced libido', 140: 'Shin splint', 141: 'Lupus erythematosus', 142: 'Depression', 143: 'Increased pressure', 144: 'Mild cognitive disorder', 145: 'Severe pain', 146: 'Bad circulation - vasomotor change', 147: 'General unsteadiness', 148: 'Difficulty riding a bicycle', 149: 'Generalised acute body pains', 150: 'Dementia', 151: 'C-reactive protein abnormal', 152: 'Xanax', 153: 'Dry skin', 154: 'Fever', 155: 'Pain in wrist', 156: 'Allergic condition', 157: 'Moderate pain', 158: 'Male climacteric', 159: 'Foot eczema', 160: 'Hyperaesthesia', 161: 'Impairment level of vision', 162: 'Urinary frequency', 163: 'Pravachol', 164: 'Mentally dull', 165: 'diclofenac', 166: 'Lasix', 167: 'Maxalt', 168: 'Aptyalism', 169: 'Uncontrollable vomiting', 170: 'Neuropathy of upper limb', 171: 'Discomfort', 172: 'Andrews Tums Antacid', 173: 'Compression neuropathy of trunk', 174: 'Difficulty moving arm', 175: 'Hypercholesterolaemia', 176: 'Deep bruising', 177: 'Periorbital oedema', 178: 'Heavy legs', 179: 'Parvovirus infection', 180: 'Cannot sleep at all', 181: 'Bone pain', 182: 'Stabbing pain', 183: 'Irregular heart rate', 184: 'Pale complexion', 185: 'Swelling of wrist joint', 186: 'Bipolar disorder', 187: 'Impaired cognition', 188: 'Fatigue', 189: 'Thoracic back pain', 190: 'Disorder of extremity', 191: 'dextropropoxyphene + paracetamol', 192: 'Elevated cholesterol/high density lipoprotein ratio', 193: 'Weight gain', 194: 'Disorder of nervous system', 195: 'Zantac', 196: 'Eye pain', 197: 'Stress overload', 198: 'Burping', 199: 'Disorder of tendon', 200: 'Forgetful', 201: 'Myalgia/myositis -pelvis/thigh', 202: 'Coma', 203: 'Reduced visual acuity', 204: 'Traumatic injury of skeletal muscle', 205: 'Swallowing problem', 206: 'Numbness of toe', 207: 'Muscle spasms of head AND/OR neck', 208: 'Lateral epicondylitis', 209: 'Post traumatic osteoarthritis', 210: 'Clammy skin', 211: 'Sensation of heaviness in limbs', 212: 'Oedema of extremity', 213: 'High pain threshold', 214: 'Swollen nasal mucosa', 215: 'Inflammatory disorder', 216: 'Oxycontin', 217: 'Unable to stand', 218: 'Tear of meniscus of knee', 219: 'Rheumatoid arthritis', 220: 'Knee joint inflamed', 221: 'Stiff limbs', 222: 'Impairment of balance', 223: 'Feeling intoxicated', 224: 'Cramp', 225: 'gemfibrozil', 226: 'paracetamol', 227: 'Dyspnoea', 228: 'Polyneuropathy', 229: 'Taste sense altered', 230: 'Knee stiff', 231: 'Blocked ears', 232: 'Fosamax', 233: 'Swelling of upper limb', 234: 'Headache', 235: 'Heart failure', 236: 'Congestion of nasal sinus', 237: 'Voltaren Rapid', 238: 'Muscle fasciculation', 239: 'Tendonitis of knee', 240: 'Subdural haematoma', 241: 'Severe dehydration', 242: 'Non-smoker', 243: 'Chill', 244: 'Unable to lift', 245: 'Warm hands', 246: 'Pain provoked by movement', 247: 'Upper respiratory tract infection', 248: 'Disorientated', 249: 'Deseril', 250: 'Sleep deprivation', 251: 'Cramp in calf', 252: 'testosterone', 253: 'Sight deteriorating', 254: 'Numbness of face', 255: 'Polymenorrhoea', 256: 'Unable to stand up', 257: 'vitamin A', 258: 'Cramp in lower leg', 259: 'Unable to speak', 260: 'Weakness of limb', 261: 'Swollen legs', 262: 'Influenza', 263: 'Serum creatinine raised', 264: 'Crying associated with mood', 265: 'Pain provoked by walking', 266: 'Abnormal vision', 267: 'misoprostol', 268: 'Urinary retention', 269: 'Pneumonia', 270: 'Senility', 271: 'Arthropathy', 272: 'Degeneration of intervertebral disc', 273: 'Lack of energy', 274: 'Oedema of finger', 275: 'Phlebitis', 276: 'Erythema', 277: 'Toe swelling', 278: 'Diverticulitis', 279: 'Cold sweat', 280: 'Anxiety', 281: 'Malaise and fatigue', 282: 'Voltaren Rapid 25 mg tablet: sugar-coated', 283: 'Irregular heart beat', 284: 'Calf muscle weakness', 285: 'Zestril', 286: 'rabeprazole', 287: 'Nasal discharge', 288: 'Personality change', 289: 'Disorder of cardiac function', 290: 'Ringing in ear', 291: 'Chronic pain', 292: 'Feels everything is futile', 293: 'Feeling agitated', 294: 'Neuroma of foot', 295: 'Propensity to adverse reactions to drug', 296: 'Absent minded', 297: 'Tinnitus', 298: 'Voltaren Emulgel', 299: 'Knee joint painful on movement', 300: 'Malignant neoplastic disease', 301: 'Isolated memory skills', 302: 'Excessive upper gastrointestinal gas', 303: 'Unable to move hand', 304: 'Burning sensation', 305: 'Infection', 306: 'Serum triglycerides raised', 307: 'Tendonitis AND/OR tenosynovitis of the elbow region', 308: 'Neurontin', 309: 'Hoarse', 310: 'Paraesthesia of hand', 311: 'Numbness of hand', 312: 'paracetamol + codeine', 313: 'Tongue swelling', 314: 'Clicking interphalangeal joint of toe', 315: 'Reduction of bulk of muscle', 316: 'Arthropathy of knee joint', 317: 'Vibration sensation present', 318: 'Endometriosis of uterus', 319: 'Ulcerative colitis', 320: 'Spasmodic movement', 321: 'Amyotrophic lateral sclerosis', 322: 'Swelling of lower limb', 323: 'Myocardial infarction', 324: 'Heartburn', 325: 'Difficulty sleeping', 326: 'Orchidodynia', 327: 'Scab of skin', 328: 'omega-3-acid ethyl esters-90', 329: 'Respiratory tract congestion', 330: 'Emotional upset', 331: 'Difficulty gripping', 332: 'Dental caries', 333: 'Repetitive strain injury', 334: 'Postmenopausal bleeding', 335: 'Impaired exercise tolerance', 336: 'Weakness of hand', 337: 'Achilles tendonitis', 338: 'Abnormal dreams', 339: 'Disorder of face', 340: 'Has delayed recall', 341: 'Numbness and tingling sensation of skin', 342: 'Degenerative disorder of muscle', 343: 'Injury of nervous system', 344: 'Intolerant of cold', 345: 'meloxicam', 346: 'Metabolic syndrome X', 347: 'Tremor', 348: 'Weight loss', 349: 'Acid reflux', 350: 'Loose stool', 351: 'Chronic fatigue syndrome', 352: 'atorvastatin', 353: 'Pain in spine', 354: 'Malignant tumour of spleen', 355: 'Distention of blood vessel', 356: 'Difficulty controlling anger', 357: 'Neuroma', 358: 'Aggression', 359: 'Contusion', 360: 'Rash', 361: 'Decreased muscle tone', 362: 'Capoten', 363: 'metoprolol', 364: 'Premenstrual tension syndrome', 365: 'Increased appetite', 366: 'bisoprolol', 367: 'tramadol', 368: 'Numbness of limbs', 369: 'Numbness', 370: 'Unable to eat', 371: 'Pain provoked by rest', 372: 'Skin nodule', 373: 'Swollen feet', 374: 'Prinivil', 375: 'Swelling of knee joint', 376: 'Cramp in lower limb', 377: 'Unable to walk down stairs', 378: 'Myalgia/myositis - lower leg', 379: 'Feeling tired', 380: 'Haemorrhage of abdominal cavity structure', 381: 'Myalgia/myositis - shoulder', 382: 'Right upper quadrant pain', 383: 'Immobile', 384: 'Tenderness of upper limb', 385: 'Abnormal large bowel motility', 386: 'Derangement of meniscus', 387: 'Bunion', 388: 'Incoordination', 389: 'Abdominal colic', 390: 'ubidecarenone', 391: 'Hypothyroidism', 392: 'Renal pain', 393: 'Rupture of tendon', 394: 'Infective cystitis', 395: 'Cold hands', 396: 'Blurring of visual image', 397: 'glibenclamide', 398: 'Right ventricular dilatation', 399: 'Flatulence/wind', 400: 'Irritability and anger', 401: 'Peripheral neuropathy', 402: 'Intolerant of heat', 403: 'Dyssomnia', 404: 'Disorder of joint of shoulder region', 405: 'Major depressive disorder', 406: 'Solaraze', 407: 'Pain radiating to lumbar region of back', 408: 'magnesium', 409: 'Eye strain', 410: 'Tightness in throat', 411: 'Mild depression', 412: 'Impatient character', 413: 'Miscarriage', 414: 'Neurological symptom', 415: 'Impaired bed mobility', 416: 'Severe visual impairment', 417: 'Malignant neoplasm of bone', 418: 'Myalgia', 419: 'Facial palsy', 420: 'Spasm of back muscles', 421: 'Neuralgia', 422: 'Bursitis', 423: 'Numbness of foot', 424: 'Cold extremities', 425: 'Memory impairment', 426: 'Disability', 427: 'Malignant tumour of prostate', 428: 'Moody', 429: 'Glossopyrosis', 430: 'Joint swelling', 431: 'Right hemiparesis', 432: 'Ankle joint pain', 433: 'Fear of falling', 434: 'Tiredness symptom', 435: 'Uterine spasm', 436: 'Swollen ankle', 437: 'Cramp in limb', 438: 'Dizziness', 439: 'Ulceration of gingivae', 440: 'Difficulty standing up', 441: 'Falls', 442: 'Muscle twitch', 443: 'Asthma', 444: 'Cluster headache', 445: 'Always hungry', 446: 'Mastalgia', 447: 'Autoimmune disease', 448: 'Alopecia', 449: 'Stammering', 450: 'Liver enzymes abnormal', 451: 'Acute gastritis', 452: 'Transient memory loss', 453: 'Celebrex', 454: 'Flushing', 455: 'zinc', 456: 'Fibromyalgia', 457: 'Thyroid disease', 458: 'Pressure', 459: 'Pain in pelvis', 460: 'Obsessive-compulsive disorder', 461: 'Renal impairment', 462: 'Disturbance in physical behaviour', 463: 'Muscle cramp', 464: 'Gastrointestinal symptom', 465: 'Intracranial tumour', 466: 'Constantly crying', 467: 'Type 1 diabetes mellitus', 468: 'Generally unwell', 469: 'Bleeding between periods', 470: 'Necrosis of anatomical site', 471: 'Oedema of hand', 472: 'Pain in right arm', 473: 'Hyperactive bowel sounds', 474: 'Unable to initiate words', 475: 'ezetimibe', 476: 'Abdominal discomfort', 477: 'Crestor', 478: 'Breast tenderness', 479: 'Pain in lower limb', 480: 'Mood disorder', 481: 'Pain in forearm', 482: 'Mental distress', 483: 'Angina', 484: 'Advil', 485: 'Shuffling gait', 486: 'Gingival disease', 487: 'Hunger pain', 488: 'Pain in left leg', 489: 'Increased liver function', 490: 'Arthrotec', 491: 'Migraine', 492: 'Unable to control anger', 493: 'amlodipine', 494: 'Transient ischaemic attack', 495: 'Cold feet', 496: 'enalapril', 497: 'Derealisation', 498: 'Increased creatine kinase level', 499: 'fish oil natural', 500: 'Sharp pain', 501: 'Fear', 502: 'Raised serum calcium level', 503: 'Urinary incontinence', 504: 'Nausea', 505: 'Ankle pain', 506: 'Lumbar arthritis', 507: 'Pain in buttock', 508: 'Unable to get out of a chair', 509: 'Delusional disorder', 510: 'Mentally alert', 511: 'Malignant neoplasm of brain', 512: 'Hyperaemia of surface of eye', 513: 'Buzzing in ear', 514: 'Arthritis of knee', 515: 'Rapid shallow breathing', 516: 'Norvasc', 517: 'Weight increased', 518: 'Lipitor 20 mg tablet: film-coated', 519: 'Loss of sense of smell', 520: 'Not getting enough sleep', 521: 'Lack of stamina', 522: 'Encephalopathy', 523: 'Middle insomnia', 524: 'Joint stiffness', 525: 'Suicidal', 526: 'Bloating symptom', 527: 'Tendonitis of foot', 528: 'Spots on skin', 529: 'Lescol', 530: 'Endometriosis', 531: 'Muscle weakness', 532: 'Hand joint stiff', 533: 'Abdominal bloating', 534: 'Visual impairment', 535: 'Acute renal failure', 536: 'Increased belching', 537: 'Irritable bowel syndrome', 538: 'ascorbic acid', 539: 'Erythema of skin', 540: 'Epipen Auto-Injector', 541: 'Constant pain', 542: 'Transient global amnesia', 543: 'Swelling of finger', 544: 'Renal injury', 545: 'Increased thirst', 546: 'Proximal interphalangeal joint of finger pain', 547: 'Agony', 548: 'Tingling of skin', 549: 'Sinusitis', 550: 'Mobic', 551: 'Sweating problem', 552: 'Always sleepy', 553: 'Watery eye', 554: 'hydrochlorothiazide', 555: 'Excessive sweating', 556: 'Increased cholesterol esters', 557: 'Musculoskeletal chest pain', 558: 'ramipril', 559: 'Jaw pain', 560: 'Dark stools', 561: 'Hypertension', 562: 'Sacroiliac joint stiff', 563: 'Shoulder girdle weakness', 564: 'Pain in thumb', 565: 'Sexual dysfunction', 566: "Alzheimer's disease", 567: "Parkinson's disease", 568: 'Sudden visual loss', 569: 'Difficulty chewing', 570: 'Rhabdomyolysis', 571: 'Sleep pattern disturbance', 572: 'Skin irritation', 573: 'Furuncle', 574: 'Influenza-like symptoms', 575: 'Pain in limb', 576: 'Low blood pressure reading', 577: 'Blepharospasm', 578: 'Rhinitis', 579: 'Heavy feeling in eyelids', 580: 'Itching of skin', 581: 'Trembles', 582: 'Nightmares', 583: 'Functional disorder of bladder', 584: 'Ovarian pain', 585: 'Pins and needles', 586: 'Poor muscle tone', 587: 'Shoulder stiff', 588: 'Musculoskeletal pain', 589: 'Joint crepitus', 590: 'Hand pain', 591: 'glipizide', 592: 'Colitis', 593: 'cyanocobalamin', 594: 'Eruption', 595: 'Menstrual loss increasing', 596: 'Feeling hopeless', 597: 'Naprosyn', 598: 'Paralysis', 599: 'Swelling of body region', 600: 'Excessive weight loss', 601: 'Mood swings', 602: 'pseudoephedrine', 603: 'Cerebrovascular accident', 604: 'Daily headache', 605: 'Lopid', 606: 'Difficulty moving hand', 607: 'Plantar fasciitis', 608: 'Ulcer', 609: 'Hip stiff', 610: 'atenolol', 611: 'Spasm', 612: 'Eczema', 613: 'Nonspecific abdominal symptom', 614: 'Type II diabetes mellitus uncontrolled', 615: 'Decreased progesterone level', 616: 'Sweating', 617: 'Hammer toe', 618: 'Ehlers-Danlos syndrome', 619: 'Choking', 620: 'Bizarre dreams', 621: 'Illness', 622: 'Stomach ache', 623: 'Nasonex Aqueous', 624: 'Osteoarthritis of knee', 625: 'Impending shock', 626: 'Arthralgia of multiple joints', 627: 'Feels hot', 628: 'lysine', 629: 'Dysmenorrhoea', 630: 'Overweight', 631: 'Temporal lobe epilepsy', 632: 'Muscle tension', 633: 'Sense of smell impaired', 634: 'Anxiety attack', 635: 'Palpitations', 636: 'Heat stroke', 637: 'Bad taste in mouth', 638: 'simvastatin', 639: 'Mentally vague', 640: 'Diarrhoea', 641: 'methylprednisolone', 642: 'Gallbladder disorder', 643: 'Loss of motivation', 644: 'Gastric ulcer with perforation', 645: 'Restless legs', 646: 'Goitre', 647: 'Excessive appetite', 648: 'Gingival oedema', 649: 'Blackout', 650: 'Dislocation of joint', 651: 'Malaria', 652: 'Tightness in arm', 653: 'Loss of taste', 654: 'Chronic rhinitis', 655: 'Joint tenderness', 656: 'Muscle Cramp', 657: 'Raised low density lipoprotein cholesterol', 658: 'Avandia', 659: 'Worried', 660: 'Difficulty swallowing', 661: 'Problem of visual accommodation', 662: 'Intermittent pain', 663: 'Decreased cholesterol esters', 664: 'Body fluid retention', 665: 'Unable to concentrate', 666: 'Difficulty getting off a bed', 667: 'Cramp in foot', 668: 'Heel pain', 669: 'Feeling bad', 670: 'Strain of calf muscle', 671: 'Clicking knee', 672: 'Unsteady when walking', 673: 'soy lecithin', 674: 'Acne', 675: 'Neuropathy of lower limb', 676: 'Dysphonia', 677: 'Finger joint locking', 678: 'Blood clot in eye', 679: 'Labour pain', 680: 'Unable to balance', 681: 'Oedema of lower extremity', 682: 'Malaise', 683: 'Heart disease', 684: 'Kidney disease', 685: 'Rotator cuff syndrome', 686: 'Arthralgia of the upper arm', 687: 'Muscle fatigue', 688: 'Wrist joint pain', 689: 'Slow on legs', 690: 'Irregular menstruation', 691: 'Sensation of hot and cold', 692: 'Feeling unhappy', 693: 'Polymyositis', 694: 'Feeling empty', 695: 'Hot sweats', 696: 'Knee pain', 697: 'Rib pain', 698: 'Plavix', 699: 'Language difficulty', 700: 'Mild pain', 701: 'Weakness of back', 702: 'Cozaar', 703: 'Pain in finger', 704: 'Elbow stiff', 705: 'Increased venous pressure', 706: 'Low motivation', 707: 'Sedated', 708: 'Parkinsonian tremor', 709: 'Intracranial aneurysm', 710: 'Premarin', 711: 'Nervousness', 712: 'Lower abdominal pain', 713: 'Polyarthritis associated with another disorder', 714: 'Cataract', 715: 'Trigeminal neuralgia', 716: 'Heavy feeling', 717: 'Unable to bend down', 718: 'Ankle stiff', 719: 'Inflammation of ligament', 720: 'Sensitivity', 721: 'Extreme exhaustion', 722: 'Hand cramps', 723: 'Urine looks dark', 724: 'Blistering rash', 725: 'Muscle injury', 726: 'Disorder of eye', 727: 'Bleeding', 728: 'Abdominal pain', 729: 'Intraocular haemorrhage', 730: 'Joint pain', 731: 'Tachycardia', 732: 'Blood pressure alteration', 733: 'Visual field scotoma', 734: 'Arthralgia', 735: 'Tightness sensation', 736: 'Hungry', 737: 'diclofenac + misoprostol', 738: 'Ulcer of oesophagus', 739: 'Dehydration', 740: 'Stiff legs', 741: 'Congestion of throat', 742: 'Poor balance', 743: 'Abnormal liver function', 744: 'Irregular bowel habits', 745: 'Hypochondriasis', 746: 'Epigastric discomfort', 747: 'Jaundice', 748: 'Iliotibial band friction syndrome', 749: 'Itching', 750: 'Chronic diarrhoea', 751: 'Olmetec', 752: 'Fine motor impairment', 753: 'Wrist stiff', 754: 'aspirin', 755: 'Bumping heart', 756: 'Unable to sit', 757: 'codeine', 758: 'Bleeding from nose', 759: 'Scalp itchy', 760: 'Shoulder joint pain', 761: 'White discolouration of skin', 762: 'Loss of appetite', 763: 'Poor self-image', 764: 'Charleyhorse', 765: 'Diabetes mellitus', 766: 'pethidine', 767: 'Moderate anxiety', 768: 'Myalgia/myositis - forearm', 769: 'Gastrointestinal tract problem', 770: 'prednisone', 771: 'Labyrinthitis', 772: 'Unable to move all four limbs', 773: 'Poor peripheral circulation', 774: 'Unable to move arm', 775: 'Chest discomfort', 776: 'capsaicin', 777: 'Coronary arteriosclerosis', 778: 'Pain in elbow', 779: 'olive oil', 780: 'Efexor-XR', 781: 'Anaemia', 782: 'Rupture of Achilles tendon', 783: 'Pounding heart', 784: 'clonidine', 785: 'Adhesive capsulitis of shoulder', 786: 'Lipidil', 787: 'Constipation', 788: 'Retching', 789: 'Aortic aneurysm', 790: 'ibuprofen 5% gel', 791: 'Metatarsalgia', 792: 'Bed-ridden', 793: 'Unsteady when standing', 794: 'Ulceration of colon', 795: 'Decreased liver function', 796: 'Serum cholesterol raised', 797: 'Insomnia', 798: 'cortisone', 799: 'Crying', 800: 'Liver function tests abnormal', 801: 'Aphthous ulcer', 802: 'Disorder of muscle', 803: 'Panic attack', 804: 'Acenaesthesia', 805: 'Amnesia', 806: 'Pain in the coccyx', 807: 'Photosensitivity', 808: 'Skin tenderness', 809: 'Difficulty writing', 810: 'naproxen', 811: 'Poor short-term memory', 812: 'Cough', 813: 'Carpal tunnel syndrome', 814: 'Pancreatitis', 815: 'Rupture of anterior cruciate ligament', 816: 'Blister', 817: 'Sciatica', 818: 'Failure to lose weight', 819: 'Haemorrhoids', 820: 'Foot pain', 821: 'Abdominal pressure', 822: 'Arthritis', 823: 'Allergic reaction', 824: 'Hepatic trauma', 825: 'Suicidal thoughts', 826: 'Lethargy', 827: 'Intervertebral disc prolapse', 828: 'paracetamol + ibuprofen', 829: 'Easy bruising', 830: 'Hyperactive behaviour', 831: 'Nexium', 832: 'Poor concentration', 833: 'Cardiomyopathy', 834: 'Loss of confidence', 835: 'Morbid thoughts', 836: 'Difficulty breathing', 837: 'Difficulty getting out of a chair', 838: 'Cardiovascular disease', 839: 'Zocor', 840: 'Excessive day and night-time sleepiness', 841: 'Tendon contracture', 842: 'Hypersomnia', 843: 'Vaginospasm', 844: 'Blind or low vision - one eye only', 845: 'Upset stomach', 846: 'Swelling', 847: 'Ophthalmic migraine', 848: 'Motor neurone disease', 849: 'Feeling lonely', 850: 'Throbbing headache', 851: 'Intra-abdominal haematoma', 852: 'Pain', 853: 'Tunnel vision', 854: 'omeprazole', 855: 'Viral upper respiratory tract infection', 856: 'Arthralgia of the lower leg', 857: 'Arthritis/arthrosis', 858: 'Joint injury', 859: 'Abdominal hyperaesthesia', 860: 'Feeling high', 861: 'potassium', 862: 'Dropped beats - heart', 863: 'Lack of libido', 864: 'Lyrica', 865: 'Feeling irritable', 866: 'Haematochezia', 867: 'pravastatin', 868: 'Unable to feed self', 869: 'Cholestatic jaundice syndrome', 870: 'Foot joint stiff', 871: 'Noise intolerance', 872: 'alpha tocopherol', 873: 'Cardiac arrhythmia', 874: 'Dependance on walking stick', 875: 'Joint laxity', 876: 'Urine: dark/concentrated', 877: 'Pain in calf', 878: 'Elbow joint swelling', 879: 'Paraesthesia of upper limb', 880: 'Numbness of upper limb', 881: 'Facial spasm', 882: 'Multiple sclerosis', 883: 'Initial insomnia', 884: 'Chronic intractable pain', 885: 'Muscle atrophy', 886: 'Urinary tract infection', 887: 'Large breast', 888: 'Loss of voice', 889: 'Renal calculus', 890: 'Drowsy', 891: 'Noten', 892: 'Increased lactic acid level', 893: 'Herpes zoster', 894: 'Injury of tendon of the rotator cuff of shoulder', 895: 'Steatosis of liver', 896: 'Hip pain', 897: 'Unable to lie down', 898: 'Type 2 diabetes mellitus', 899: 'Morning stiffness - joint', 900: 'codeine + ibuprofen', 901: 'Unable to make a fist', 902: 'Hepatomegaly', 903: 'Tenalgia', 904: 'Lipitor', 905: 'Disorder of skin', 906: 'Involuntary movement', 907: 'Influenza-like illness', 908: 'Unable to get off a bed', 909: 'Psychotic disorder', 910: 'Testosterone', 911: 'Indigestion', 912: 'Feeling angry', 913: 'Vertigo', 914: 'Sinus pain', 915: 'Numbness of lower limb', 916: 'fenofibrate', 917: 'Stevens-Johnson syndrome', 918: 'Nasal sinus problem', 919: 'Myalgia/myositis - upper arm', 920: 'Loss of hair', 921: 'Neuropathy', 922: 'Dysfunctional uterine bleeding', 923: 'Lyme disease', 924: 'pyridoxine', 925: 'Glossitis', 926: 'Fragile self-esteem', 927: 'Arthritis of hip', 928: 'Vomiting', 929: 'Stiff neck', 930: 'Restlessness', 931: 'Blood coagulation disorder', 932: 'Heavy episode of vaginal bleeding', 933: 'Unable to move leg', 934: 'Peritonitis', 935: 'White blood cell count abnormal', 936: 'Weakness of neck', 937: 'Decrease in appetite', 938: 'Exhaustion', 939: 'Unable to run', 940: 'Bacterial sepsis', 941: 'Disorder of vision', 942: 'Paraesthesia', 943: 'Abdominal swelling', 944: 'Mucosal numbness', 945: 'Osteoarthrosis of hand', 946: 'Loss of equilibrium', 947: 'Stress', 948: 'Contusion of hand', 949: 'Nerve injury', 950: 'Scleral icterus', 951: 'Injury of muscle', 952: 'Toothache', 953: 'Infectious disease of lung', 954: 'Stomach problem', 955: 'Haematuria', 956: 'Hypomenorrhoea', 957: 'Unable to walk up step', 958: 'Abdominal distension, gaseous', 959: 'Anger reaction', 960: 'Excruciating pain', 961: 'Pain in throat', 962: 'Pruritus ani', 963: 'Traumatic blister of mouth', 964: 'Myopathy', 965: 'Numbness of finger', 966: 'Generalised pruritus', 967: 'Nocturnal enuresis', 968: 'Abdominal wind pain', 969: 'Deteriorating renal function', 970: 'Muscle rigidity', 971: 'Difficulty standing', 972: 'Burning sensation of vagina', 973: 'Asthenia', 974: 'Ezetrol', 975: 'Common cold', 976: 'Rupture of muscle', 977: 'Rhinocort Aqueous', 978: 'caffeine', 979: 'Loss of interest', 980: 'Tylenol', 981: 'Tired', 982: 'Blurred vision - hazy', 983: 'glucosamine', 984: 'Severe depression', 985: 'Bronchitis', 986: 'Limitation of joint movement', 987: 'Vaginal bleeding', 988: 'Tinea pedis', 989: 'Difficulty lifting', 990: 'Feeling faint', 991: 'Night sweats', 992: 'Burning pain', 993: 'Aleve', 994: 'Abrasion of eye region', 995: 'Confusion', 996: 'Bursitis of hip', 997: 'Degenerative disease of the central nervous system', 998: 'Thigh pain', 999: 'Paraesthesia of lower extremity', 1000: 'Basic learning problem', 1001: 'Abnormal muscle function', 1002: 'Chest pain', 1003: 'Liver disease', 1004: 'Hepatic failure', 1005: 'Cymbalta', 1006: 'Paraesthesia of foot', 1007: 'Neck pain', 1008: 'Dry hair', 1009: 'Myositis', 1010: 'Thoughts of self harm', 1011: 'Respiratory depression', 1012: 'Irritable bowel syndrome characterised by constipation', 1013: "Bell's palsy", 1014: 'Increased lipid', 1015: 'Dry eyes', 1016: 'Swollen knee', 1017: 'Facial swelling', 1018: 'Lexapro', 1019: 'Flank pain', 1020: 'Decreased testosterone level', 1021: 'Hives', 1022: 'Malignant tumour of colon', 1023: 'Digestive symptom', 1024: 'Pain in toe', 1025: 'Voltaren', 1026: 'C/O - feeling depressed', 1027: 'Burning feet', 1028: 'Mental disorder', 1029: 'Unable to climb stairs', 1030: 'Tires quickly', 1031: 'Backache', 1032: 'Reflux', 1033: 'Abnormal blood pressure', 1034: 'Calcaneal spur', 1035: 'Gingivitis', 1036: 'Excitement', 1037: 'Menstrual spotting', 1038: 'Tired all the time', 1039: 'Bowel dysfunction'}


    feed_dict = {
        model.input_x: input_x,
        model.keep_prob: 1,
        model.sequence_lengths: get_sequence_length(input_x)
    }
    session = tf.Session()
    session.run(tf.global_variables_initializer())
    saver = tf.train.Saver()
    saver.restore(sess=session, save_path=save_path)
    y_prob=session.run(tf.nn.softmax(model.logits), feed_dict=feed_dict)
    y_prob=y_prob.tolist()
    cat=[]
    for prob in y_prob:
        top2= list(map(prob.index, heapq.nlargest(1, prob)))
        cat.append(labels[top2[0]])
    tf.reset_default_graph()
    return  cat

def sentence_cut(sentences):
    """
    Args:
        sentence: a list of text need to segment
    Returns:
        seglist:  a list of sentence cut by jieba

    """
    re_han = re.compile(u"([\u4E00-\u9FD5a-zA-Z0-9+#&\._%]+)")  # the method of cutting text by punctuation
    seglist=[]
    for sentence in sentences:
        words=[]
        blocks = re_han.split(sentence)
        for blk in blocks:
            if re_han.match(blk):
                words.extend(jieba.lcut(blk))
        seglist.append(words)
    return  seglist


def process_file(sentences,word_to_id,max_length=600):
    """
    Args:
        sentence: a text need to predict
        word_to_id:get from def read_vocab()
        max_length:allow max length of sentence
    Returns:
        x_pad: sequence data from  preprocessing sentence

    """
    data_id=[]
    seglist=sentence_cut(sentences)
    for i in range(len(seglist)):
        data_id.append([word_to_id[x] for x in seglist[i] if x in word_to_id])
    x_pad=kr.preprocessing.sequence.pad_sequences(data_id,max_length)
    return x_pad


def read_vocab(vocab_dir):
    """
    Args:
        filename:path of vocab_filename
    Returns:
        words: a list of vocab
        word_to_id: a dict of word to id

    """
    words = codecs.open(vocab_dir, 'r', encoding='utf-8').read().strip().split('\n')
    word_to_id = dict(zip(words, range(len(words))))
    return words, word_to_id

def get_training_word2vec_vectors(filename):
    """
    Args:
        filename:numpy file
    Returns:
        data["embeddings"]: a matrix of vocab vector
    """
    with np.load(filename) as data:
        return data["embeddings"]

def get_sequence_length(x_batch):
    """
    Args:
        x_batch:a batch of input_data
    Returns:
        sequence_lenghts: a list of acutal length of  every senuence_data in input_data
    """
    sequence_lengths=[]
    for x in x_batch:
        actual_length = np.sum(np.sign(x))
        sequence_lengths.append(actual_length)
    return sequence_lengths





if __name__ == '__main__':
    print('predict random five samples in test data.... ')
    import random
    sentences=[]
    labels=[]
    with codecs.open('./data/cnews.test.txt','r',encoding='utf-8') as f:
        sample=random.sample(f.readlines(),5)
        for line in sample:
            try:
                line=line.rstrip().split('\t')
                assert len(line)==2
                sentences.append(line[1])
                labels.append(line[0])
            except:
                pass
    cat=predict(sentences)
    for i,sentence in enumerate(sentences,0):
        print ('----------------------the text-------------------------')
        print (sentence[:50]+'....')
        print('the orginal label:%s'%labels[i])
        print('the predict label:%s'%cat[i])

